#!/usr/bin/env ruby

require 'optparse'
require_relative '../lib/fan'

options = {list: false}
OptionParser.new do |opts|
  opts.on('-l', '--list', 'list all') do |l|
    options[:list] = true
  end

  opts.on('-k KEY', '--key=KEY', 'get value for <key>') do |key|
    options[:key] = key
  end

  opts.on('-v VAL', '--value=VAL', 'set config for <key> to <value>') do |value|
    options[:value] = value
  end
end.parse!

def show_help
  msg = <<-EOF
Usage: fk config [options]
  fk config --key=<key>                  -- retrieve value stored at <key>
  fk config --key=<key> --value=<value>  -- set <key> to <value>
  EOF
  puts msg
  exit(1)
end

def valid_option?(opt)
  false unless opt.has_key?(:key) or opt[:list]
  true
end

show_help unless valid_option?(options)

configs = Fan::Configs.new

if options.has_key?(:value)
  configs.set!(key: options[:key], value: options[:value])
  puts "#{options[:key]}: #{configs.get(key: options[:key])}"
elsif options[:list]
  configs.all.each do |k, v|
    puts "#{k}: #{v}"
  end
else
  puts configs.get(key: options[:key])
end

